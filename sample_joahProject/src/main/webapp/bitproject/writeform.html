<!DOCTYPE html>
<html>
<head>
<meta charset='UTF-8'>
<title>Hot place</title>
<link rel="stylesheet" href="../lib/bootstrap/css/bootstrap.css">
<!-- <link rel="stylesheet" href="../css/common.css"> -->
<link rel="stylesheet" type="text/css" href="../lib/mycss/style_detail.css" />
<link rel="stylesheet" type="text/css" href="../lib/mycss/style_header.css" />
<script type="text/javascript" src="js/jquery.js"></script>
<script type="text/javascript" src="js/bootstrap.min.js"></script>
<script type="text/javascript" src="js/lightbox.min.js"></script>
<script type="text/javascript" src="js/wow.min.js"></script>
<script type="text/javascript" src="js/main.js"></script> 
<script type="text/javascript" src="../lib/jquery/jquery.min.js"></script>
<script type="text/javascript" src="../lib/myjs/jquery-ui.min.js"></script>
<script type="text/javascript" src="../lib/myjs/modernizr.js"></script>
<script src="../lib/blueimp-file-upload/js/vendor/jquery.ui.widget.js"></script>
<script src="../lib/blueimp-file-upload/js/jquery.iframe-transport.js"></script>
<script src="../lib/blueimp-file-upload/js/jquery.fileupload.js"></script>


<link href="css/bootstrap.min.css" rel="stylesheet">
<link href="css/font-awesome.min.css" rel="stylesheet">
<link href="css/lightbox.css" rel="stylesheet">
<link href="css/animate.min.css" rel="stylesheet">
<link href="css/main.css" rel="stylesheet">
<link href="css/responsive.css" rel="stylesheet">

<script type="text/javascript"
      src="http://openapi.map.naver.com/openapi/v2/maps.js?clientId=ql7iZyYF1MnnPLwV_69L"></script>
<!-- 맵 인포 윈도우 시작. -->
<style>
.wrap {position: absolute;left: 0;bottom: 40px;width: 288px;height: 132px;margin-left: -144px;text-align: left;overflow: hidden;font-size: 12px;font-family: 'Malgun Gothic', dotum, '돋움', sans-serif;line-height: 1.5;}
    .wrap * {padding: 0;margin: 0;}
    .wrap .info {width: 286px;height: 120px;border-radius: 5px;border-bottom: 2px solid #ccc;border-right: 1px solid #ccc;overflow: hidden;background: #fff;}
    .wrap .info:nth-child(1) {border: 0;box-shadow: 0px 1px 2px #888;}
    .info .title {padding: 5px 0 0 10px;height: 30px;background: #eee;border-bottom: 1px solid #ddd;font-size: 18px;font-weight: bold;}
    .info .close {position: absolute;top: 10px;right: 10px;color: #888;width: 17px;height: 17px;background: url('http://i1.daumcdn.net/localimg/localimages/07/mapapidoc/overlay_close.png');}
    .info .close:hover {cursor: pointer;}
    .info .body {position: relative;overflow: hidden;}
    .info .desc {position: relative;margin: 13px 0 0 90px;height: 75px;}
    .desc .ellipsis {overflow: hidden;text-overflow: ellipsis;white-space: nowrap;}
    .desc .jibun {font-size: 11px;color: #888;margin-top: -2px;}
    .info .img {position: absolute;top: 6px;left: 5px;width: 73px;height: 71px;border: 1px solid #ddd;color: #888;overflow: hidden;}
</style>
<!-- 맵 인포 윈도우 끝-->
</head>
<body>
  <div id="main_container">

    <!-- header -->
    <header id="h_title"></header>

    <script>
$.ajax({
    url : "header.html",
    dataType : "html",
    type : "get",  // post 또는 get
    success : function(result){
        $("#h_title").html(result);
     }
});
</script>

    <!------------------------------------------>
    <!--              header  끝              -->
    <!------------------------------------------>

    <!------------------------------------------>
    <!--              지도와 작성폼           -->
    <!------------------------------------------>
    <!-- <form action="post"> -->
    <div class="center_content_pages">
      <div class="pages_banner">게시물 등록</div>
    </div>
    <section id="portfolio">
      <div class="right_content">
        <h3>다녀온 데이트의 간단한 제목을 등록해주세요.</h3>
                <input type="text" id="input_title" name="title" class="form-control" required="required" placeholder="제목"
                style="background-color:transparent; border:0 solid black; font-size:13px;">
        
         <div id="testMap" style="width: 800px; height:500px; margin: 10px 0 0 0;"></div>
       </div>

      <div class="left_content">
         <label style="margin: 15px 0 15px 55px; font-size: 20px; ">다녀온 곳</label>
        <div class="sidebar blog-sidebar">
          <div class="sidebar-item categories" id="visitedList">
          <!-- 리스트 ajax로 띄움. -->  
          </div>
        </div>
      </div>
    </section>
    
    <!-- 밑줄 한줄 -->
    <div>
      <hr style="position:relative; width:90%; border-top: 2px solid lightgray; ">
    </div>
    <!-- 밑줄 한줄 끝 -->
    
    <section>
      <div class="row">
      <div class="col-sm-1"></div>
                <div class="col-sm-5">
                <h2>후기 작성</h2>
                <textarea id="input_content" rows="13" cols="60" placeholder="내용을 입력해주세요"></textarea>
                </div>
                <div class="col-sm-6">
                    <h2>PHOTO</h2>
                    <input type='file' class="form-control" id="ffile" name="files" multiple>
                        <div style="border:1px solid gray" class="wow fadeInUp col-sm-4" data-wow-duration="900ms" data-wow-delay="100ms">
                        <img src="images/portfolio/1.jpg"></div>
                        <div style="border:1px solid gray" class="wow fadeInUp col-sm-4" data-wow-duration="800ms" data-wow-delay="200ms">
                        <img src="images/portfolio/2.jpg"></div>
                        <div style="border:1px solid gray" class="wow fadeInUp col-sm-4" data-wow-duration="700ms" data-wow-delay="300ms">
                        <img src="images/portfolio/3.jpg"></div>
                        <div style="border:1px solid gray" class="wow fadeInUp col-sm-4" data-wow-duration="600ms" data-wow-delay="100ms">
                        <img src="images/portfolio/4.jpg"></div>
                        <div style="border:1px solid gray" class="wow fadeInUp col-sm-4" data-wow-duration="500ms" data-wow-delay="200ms">
                        <img src="images/portfolio/5.jpg"></div>
                        <div style="border:1px solid gray" class="wow fadeInUp col-sm-4" data-wow-duration="400ms" data-wow-delay="300ms">
                        <img src="images/portfolio/6.jpg"></div>
                    
                </div>
            </div>
    </section>
    <div>
      <hr style="position:relative; width:90%; border-top: 2px solid lightgray; ">
    </div>
    <button class="btn btn-primary" id="addToboard" style="position:relative; left:1020px;">게시판에 등록</button>
    <button class="btn btn-default" id="share_facebook" style="position:relative; left:760px;">페이스북에 공유</button>
    <!-- </form> -->
<footer>
    <div>
      <hr style="position:relative; width:90%; border-top: 2px solid lightgray; ">
    </div>
    아에이오우아에이오우
</footer>
</div>
    <!------------------------------------------>
    <!--              지도스크립트            -->
    <!------------------------------------------>
  
 <script type="text/javascript">
 var oPoint = new nhn.api.map.LatLng(37.5010226, 127.0396037);                       
 var oCenterPoint = new nhn.api.map.LatLng(37.5010226, 127.0396037);
                        nhn.api.map.setDefaultPoint('LatLng');
                        oMap = new nhn.api.map.Map('testMap', {
                            point : oPoint, // 여기에다 현재 위치를 추가하면 됨.
                            zoom : 10,
                            enableWheelZoom : true,
                            enableDragPan : true,
                            enableDblClickZoom : true,
                            mapMode : 0, // 맵 모드 0:기본 1:위성 2:기본+위성
                            activateTrafficMap : false,
                            activateBicycleMap : false,
                            minMaxLevel : [ 1, 14 ],
                            size : new nhn.api.map.Size(800, 400)
                          // 지도 크기.
                          });

                          var mapZoom = new nhn.api.map.ZoomControl(); // - 줌 컨트롤 선언
                          oMap.addControl(mapZoom); // - 줌 컨트롤 추가.
                          mapZoom.setPosition({
                            left : 760,
                            bottom : 25
                          }); // - 줌 컨트롤 위치 지정.

                          // 아이콘설정
                          var oSize = new nhn.api.map.Size(20, 21);
                          var oOffset = new nhn.api.map.Size(14, 37);
                          var oIcon = new nhn.api.map.Icon('1.png', oSize, oOffset); // 지도에 표시될 아이콘


                          var oLabel = new nhn.api.map.MarkerLabel(); // - 마커 라벨 선언.
                          oMap.addOverlay(oLabel); // - 마커 라벨 지도에 추가. 기본은 라벨이 보이지 않는 상태로 추가됨.

                          
                          
                          /* 마커 추가하기 + 해당하는 Infowindow 만들기 n 반복*/
                          
                          var oMarkers = [];
                          var mapInfoTestWindow = [];
                          var searchNo;
                          var objNo;
                          var boardNo = location.href.split('?')[1].split('=')[1];
                          var visitedList = $("#visitedList");
                          $.getJSON('ajax/courselist.do?bno=' + boardNo, function(resultObj) {
                            for(var location of resultObj.data) {
                              $("<ul class='nav navbar-stacked'>")
                              .html("<li><a>"+ location.name +"</a></li>")
                              .appendTo(visitedList);
                              
                              oMarkers[location.lno] = new nhn.api.map.Marker(oIcon, {
                                      title : location.name,
                                      smallSrc: location.lno
                                    });
                              oMarkers[location.lno].setPoint(new nhn.api.map.LatLng(location.lng, location.lat))
                              oMap.addOverlay(oMarkers[location.lno]);
                              
                              mapInfoTestWindow[location.lno] = new nhn.api.map.InfoWindow({
                                point: oMarkers[location.lno].getPoint(),
                                content: '<div class="wrap">' +
                                '    <div class="info">' +
                                '        <div class="title">'+ location.name  +
                                '            <div class="close" onclick="closeOverlay()" title="닫기"></div>' +
                                '        </div>' +
                                '        <div class="body">' +
                                '            <div class="img">' +
                                '                <img src="'+ location.photo +'" width="73" height="70">' +
                                '           </div>' +
                                '            <div class="desc">' +
                                '                <div class="ellipsis">'+ location.content + '</div>' +
                                '                <div class="jibun ellipsis"></div>' +
                                '                <div class="choice_1" id="choice_id'+location.lno+'" style="position:relative; top:25px; left:150px">' +
                                '                <button type="button" class="btn btn-default btn-xs">선택</button></div>' + // 선택 분류할 때 div를 다르게 하기.
                                '    </div>' +
                                '</div>'
                              });
                              mapInfoTestWindow[location.lno].setVisible(false);
                              oMap.addOverlay(mapInfoTestWindow[location.lno]);
                              
                             mapInfoTestWindow[location.lno].attach('changeVisible', function(oCustomEvent) {
                                 if (oCustomEvent.visible) {
                                   oLabel.setVisible(false);
                                  }
                                });
                             oMarkers[location.lno].setVisible(true);
                             
                             
                            } // for문 끝 
                            oMap.setCenter(new nhn.api.map.LatLng(location.lng, location.lat));
                          }); // AJAX 호출 끝
                            
                          
                          /* 정보창에서 선택하는 것 */
                          var c_count = 1; // 다른 선택창에 정보 기록하려고
                          var filterOne = 0;
                          var targetNo;  // 열고싶은 창 번호.
                          var targetWindow = 0; // 열었던 창 번호.
                          oMap.attach('click', function(oCustomEvent) {
                            var oTarget = oCustomEvent.target;
                            if (oTarget instanceof nhn.api.map.Marker) {
                                if (oCustomEvent.clickCoveredMarker) {
                                    return; //중복마커일때 처리하는 부분
                                }  
                              targetNo = oTarget._smallSrc;
                              
                              if (targetWindow == 0) {
                                mapInfoTestWindow[targetNo].setVisible(true);
                                mapInfoTestWindow[targetNo].setPosition({right : 15, top : 30});
                                mapInfoTestWindow[targetNo].autoPosition();
                                targetWindow = targetNo;
                                
                              } else if (targetWindow != 0) {
                                mapInfoTestWindow[targetWindow].setVisible(false);
                                mapInfoTestWindow[targetNo].setVisible(true);
                                mapInfoTestWindow[targetNo].setPosition({right : 15, top : 30});
                                mapInfoTestWindow[targetNo].autoPosition();
                                targetWindow = targetNo;
                              }
                           } 
                               if (!(oTarget instanceof nhn.api.map.Marker)) {
                                mapInfoTestWindow[targetWindow].setVisible(false);
                              } // 마커가 아니면 클릭시 닫힌다. 
                               console.log(targetNo);
                          });
                          
                          console.log(targetNo);
                          
                          

                          function closeOverlay() {
                            mapInfoTestWindow[targetWindow].setVisible(false);
                          }
                          
                          oMap.attach('mouseenter', function(oCustomEvent) {
                            var oTarget = oCustomEvent.target;
                            // 마커위에 마우스 올라간거면
                            if (oTarget instanceof nhn.api.map.Marker) {
                              var oMarker = oTarget;
                              oLabel.setVisible(true, oMarker); // - 특정 마커를 지정하여 해당 마커의 title을 보여준다.
                            }
                            
                            $("#choice_id"+ targetNo).click(function(event) {
                              if(targetNo != filterOne) {
                                event.preventDefault();
                                console.log("카운트 : "+c_count);
                                if ((c_count%4) == 1) {
                                  /* $("#choice_div1").text(targetNo); */
                                  $.getJSON('ajax/locationDetail.do?no=' + targetNo, function(resultObj) {
                                      var ajaxResult = resultObj.ajaxResult;
                                      if (ajaxResult.status == "success") {
                                        var location = ajaxResult.data;
                                        $("#choice_div1").html("<img src='"+ location.photo +"' id='img_icon' class='img-circle'>" +
                                            "<input type='hidden' name='lno1' value='"+ targetNo +"'>");
                                      }
                                  });
                                  c_count++;
                                } else if ((c_count%4) == 2) {
                                  $.getJSON('ajax/locationDetail.do?no=' + targetNo, function(resultObj) {
                                        var ajaxResult = resultObj.ajaxResult;
                                        if (ajaxResult.status == "success") {
                                          var location = ajaxResult.data;
                                          $("#choice_div2").html("<img src='"+ location.photo +"' class='img-circle'>" +
                                                  "<input type='hidden' name='lno2' value='"+ targetNo +"'>");
                                        }
                                    });
                                  c_count++;
                                } else if ((c_count%4) == 3) {
                                  $.getJSON('ajax/locationDetail.do?no=' + targetNo, function(resultObj) {
                                        var ajaxResult = resultObj.ajaxResult;
                                        if (ajaxResult.status == "success") {
                                          var location = ajaxResult.data;
                                          $("#choice_div3").html("<img src='"+ location.photo +"' class='img-circle'>" +
                                                  "<input type='hidden' name='lno3' value='"+ targetNo +"'>");
                                        }
                                    });
                                  c_count++;
                                } else if ((c_count%4) == 0) {
                                  $.getJSON('ajax/locationDetail.do?no=' + targetNo, function(resultObj) {
                                        var ajaxResult = resultObj.ajaxResult;
                                        if (ajaxResult.status == "success") {
                                          var location = ajaxResult.data;
                                          $("#choice_div4").html("<img src='"+ location.photo +"' class='img-circle'>" +
                                                  "<input type='hidden' name='lno4' value='"+ targetNo +"'>");
                                        }
                                    });
                                  c_count++;
                                }
                              }
                               filterOne = targetNo;
                            });
                          });
                          
                          oMap.attach('mouseleave', function(oCustomEvent) {
                            var oTarget = oCustomEvent.target;
                            // 마커위에서 마우스 나간거면
                            if (oTarget instanceof nhn.api.map.Marker) {
                              oLabel.setVisible(false);
                            }
                          }); 
     </script>
     <script type="text/javascript">
       try {document.execCommand('BackgroundImageCache', false, true);} catch(e) {}
     </script>
     
     <!-- 등록 폼 -->
     <!-- <script>
     $("#addToboard").click(function(event) {
         console.log(boardNo);
         $.post('ajax/realAddboard.do', {
           bno: boardNo,
           title: $('#input_title').val(),
           content: $('#input_content').val(),
           success: function(resultObj) {
             console.log("user_rec 등록성공!");
           }
        }, function(resultObj) {
         //mylist.do
           $.post('ajax/mylist.do', {
             bno: boardNo,
             title: $('#input_title').val(),
             content: $('#input_content').val(),
             success: function(resultObj) {
             console.log("내가 작성한 게시물에 등록성공!");
             }
           }, function(resultObj) {
             console.log("user_rec와 내가 작성한 게시물에 등록 성공");
             location.href="index.html";
           }, 'json');
        }, 'json');
     });
     </script> -->
<script>
$('#ffile').fileupload({
  url:'ajax/photo/upload.do',
  dataType: 'json',
  singleFileUploads: false, // 서버에 한 번만 요청을 보내라.
  add: function (e, data) {
  console.log("파일을 추가하였음...");
  $('#addToboard').click(function(event) {
   console.log("서버에 전송함...");
   data.formData = {
    };
    data.submit();
    });
   },
   done: function (e, data) {
   console.log(data.result.ajaxResult.data);
   var photo = data.result.ajaxResult.data
   console.log(photo.length);
    		  
  /*  for (var i = 0; i < photo.length; i++) {	 */
   $.post('ajax/photo/add.do', {	
   	 bno : boardNo,
   	 photoName: photo,
   	 success: function(resultObj) {
        console.log("내가 작성한 게시물에 등록성공!");
        }
   	 }
  /* } */
   , 
   function(resultObj) {
   $.post('ajax/realAddboard.do', {
   bno: boardNo,
   title: $('#input_title').val(),
   content: $('#input_content').val(),
   success: function(resultObj) {
   console.log("user_rec 등록성공!");
   }
   }, function(resultObj) {
   console.log("user_rec와 내가 작성한 게시물에 등록 성공");
   location.href="index.html";
   }, 'json');
   }, 'json');
}
});
</script>
     
</body>
</html>