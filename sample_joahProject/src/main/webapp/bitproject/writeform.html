<!DOCTYPE html>
<html>
<head>
<meta charset='UTF-8'>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Tab Styles Inspiration: A small collection of styles for tabs" />
<meta name="keywords" content="tabs, inspiration, web design, css, modern, effects, svg" />
<meta name="author" content="Codrops" />
<title>JOAH | by One Point</title>
<link rel="stylesheet" type="text/css" href="../lib/mycss/style_search.css" />
<link rel="stylesheet" type="text/css" href="../lib/mycss/style_header.css" />

 <link href="css/bootstrap.min.css" rel="stylesheet">
 <link href="css/font-awesome.min.css" rel="stylesheet">
 <link href="css/lightbox.css" rel="stylesheet">
 <link href="css/animate.min.css" rel="stylesheet">
 <link href="css/main.css" rel="stylesheet">
 <link href="css/responsive.css" rel="stylesheet">
  <script type="text/javascript" src="js/jquery-1.11.3.js"></script>
  <script type="text/javascript" src="js/bootstrap.min.js"></script>
  <script type="text/javascript" src="js/lightbox.min.js"></script>
  <script type="text/javascript" src="js/wow.min.js"></script>
  <script type="text/javascript" src="js/main.js"></script>
  <script type="text/javascript" src="js/modernizr.custom.js"></script>
<script type="text/javascript" src="../lib/myjs/modernizr.js"></script>
    <script type="text/javascript"
      src="http://openapi.map.naver.com/openapi/naverMap.naver?ver=2.0&key=553205575474122b3423699dc799445d"></script>
<!-- 맵 인포 윈도우 시작. -->
<style>
.wrap {position: absolute;left: 0;bottom: 40px;width: 288px;height: 132px;margin-left: -144px;text-align: left;overflow: hidden;font-size: 12px;font-family: 'Malgun Gothic', dotum, '돋움', sans-serif;line-height: 1.5;}
    .wrap * {padding: 0;margin: 0;}
    .wrap .info {width: 286px;height: 120px;border-radius: 5px;border-bottom: 2px solid #ccc;border-right: 1px solid #ccc;overflow: hidden;background: #fff;}
    .wrap .info:nth-child(1) {border: 0;box-shadow: 0px 1px 2px #888;}
    .info .title {padding: 5px 0 0 10px;height: 30px;background: #eee;border-bottom: 1px solid #ddd;font-size: 18px;font-weight: bold;}
    .info .close {position: absolute;top: 10px;right: 10px;color: #888;width: 17px;height: 17px;background: url('http://i1.daumcdn.net/localimg/localimages/07/mapapidoc/overlay_close.png');}
    .info .close:hover {cursor: pointer;}
    .info .body {position: relative;overflow: hidden;}
    .info .desc {position: relative;margin: 13px 0 0 90px;height: 75px;}
    .desc .ellipsis {overflow: hidden;text-overflow: ellipsis;white-space: nowrap;}
    .desc .jibun {font-size: 11px;color: #888;margin-top: -2px;}
    .info .img {position: absolute;top: 6px;left: 5px;width: 73px;height: 71px;border: 1px solid #ddd;color: #888;overflow: hidden;}
</style>
<!-- 맵 인포 윈도우 끝-->
</head>
<body>
	<div id="main_container">

		<!-- header -->
		<header id="h_title"></header>

		<script>
$.ajax({
    url : "header.html",
    dataType : "html",
    type : "get",  // post 또는 get
    success : function(result){
        $("#h_title").html(result);
     }
});
</script>

		<!------------------------------------------>
		<!--              header  끝              -->
		<!------------------------------------------>



    <!------------------------------------------>
    <!--              지도와 작성폼           -->
    <!------------------------------------------>
		<div class="center_content_pages">
			<div class="pages_banner">게시물 작성</div>
			
			<div class="form">
			 <div class="contact-form bottom" style="width:800px; height:1200px; margin-left:18%">
         <form id="main-contact-form" name="contact-form" method="post">
         <h2 class="page-header" 
         style="padding-bottom:5px;margin: 10px 0 10px;border-bottom: 1px solid #aaa;">Title</h2>
			   <input type="text" name="name" class="form-control" required="required" placeholder="제목" style="width:800px">
   			<h2 class="page-header" 
         style="padding-bottom:5px;margin: 10px 0 10px;border-bottom: 1px solid #aaa;">Map</h2>
   			<div id="testMap" style="width: 800px; height: 400px; margin: 0;"></div>
   			<h2 class="page-header" 
         style="padding-bottom:5px;margin: 10px 0 10px;border-bottom: 1px solid #aaa;">Content</h2>
   			<textarea rows="10" cols="100" placeholder="내용을 입력하세요" style="width:800px"></textarea>
   			<h2 class="page-header" 
         style="padding-bottom:5px;margin: 10px 0 10px;border-bottom: 1px solid #aaa;">Photo</h2>
			   <input type="file" name="photo[]">
			   <button class="btn btn-primary" >게시</button>
			   </form>
			</div>
		</div>
	</div>


</div>
    <!------------------------------------------>
    <!--              지도스크립트            -->
    <!------------------------------------------>
	<script type="text/javascript" src="../lib/jquery/jquery.min.js"></script>
 <script type="text/javascript">
 var oPoint = new nhn.api.map.LatLng(37.5010226, 127.0396037);                       
 var oCenterPoint = new nhn.api.map.LatLng(37.5010226, 127.0396037);
                        nhn.api.map.setDefaultPoint('LatLng');
                        oMap = new nhn.api.map.Map('testMap', {
                            point : oPoint, // 여기에다 현재 위치를 추가하면 됨.
                            zoom : 10,
                            enableWheelZoom : true,
                            enableDragPan : true,
                            enableDblClickZoom : true,
                            mapMode : 0, // 맵 모드 0:기본 1:위성 2:기본+위성
                            activateTrafficMap : false,
                            activateBicycleMap : false,
                            minMaxLevel : [ 1, 14 ],
                            size : new nhn.api.map.Size(800, 400)
                          // 지도 크기.
                          });

                          var mapZoom = new nhn.api.map.ZoomControl(); // - 줌 컨트롤 선언
                          oMap.addControl(mapZoom); // - 줌 컨트롤 추가.
                          mapZoom.setPosition({
                            left : 760,
                            bottom : 25
                          }); // - 줌 컨트롤 위치 지정.

                          // 아이콘설정
                          var oSize = new nhn.api.map.Size(20, 21);
                          var oOffset = new nhn.api.map.Size(14, 37);
                          var oIcon = new nhn.api.map.Icon('1.png', oSize, oOffset); // 지도에 표시될 아이콘


                          var oLabel = new nhn.api.map.MarkerLabel(); // - 마커 라벨 선언.
                          oMap.addOverlay(oLabel); // - 마커 라벨 지도에 추가. 기본은 라벨이 보이지 않는 상태로 추가됨.

                          
                          
                          /* 마커 추가하기 + 해당하는 Infowindow 만들기 n 반복*/
                          
                          var oMarkers = [];
                          var openMarkers = [];
                          var mapInfoTestWindow = [];
                          var searchNo;
                          var objNo;
                          var boardNo = location.href.split('?')[1].split('=')[1];
                          
                          $.getJSON('ajax/courselist.do?bno=' + boardNo, function(resultObj) {
                            var i = 0;
                            for(var location of resultObj.data) {
                            
                              oMarkers[location.lno] = new nhn.api.map.Marker(oIcon, {
                                      title : location.name,
                                      smallSrc: location.lno
                                    });
                              oMarkers[location.lno].setPoint(new nhn.api.map.LatLng(location.lng, location.lat))
                              oMap.addOverlay(oMarkers[location.lno]);
                              
                              mapInfoTestWindow[location.lno] = new nhn.api.map.InfoWindow({
                                point: oMarkers[location.lno].getPoint(),
                                content: '<div class="wrap">' +
                                  '    <div class="info">' +
                                  '        <div class="title">'+ location.name  +
                                  '            <div class="close" onclick="closeOverlay()" title="닫기"></div>' +
                                  '        </div>' +
                                  '        <div class="body">' +
                                  '            <div class="img">' +
                                  '                <img src="'+ location.photo +'" width="73" height="70">' +
                                  '           </div>' +
                                  '            <div class="desc">' +
                                  '                <div class="ellipsis">'+ location.content  + '여기다가 상세정보' +
                                  '                <div class="jibun ellipsis">(우) 63309 (지번) ?? 2181</div>' +
                                  '                <div class="choice_1" id="choice_id'+location.lno+'"><button type="button" class="btn btn-default btn-xs" style="align:right;">선택</button></div>' + // 선택 분류할 때 div를 다르게 하기.
                                  '            </div>' +
                                  '        </div>' +
                                  '    </div>' +
                                  '</div>'
                              });
                              mapInfoTestWindow[location.lno].setVisible(false);
                              oMap.addOverlay(mapInfoTestWindow[location.lno]);
                              
                             mapInfoTestWindow[location.lno].attach('changeVisible', function(oCustomEvent) {
                                 if (oCustomEvent.visible) {
                                   oLabel.setVisible(false);
                                  }
                                });
                             oMarkers[location.lno].setVisible(true);
                             
                             
                               openMarkers[i] = location.lno;
                               i++; // 닫기 위해 기존 있던 마커넘버를 저장하는 것.
                            } // for문 끝 
                            
                          }); // AJAX 호출 끝
                            
                          
                          /* 정보창에서 선택하는 것 */
                          var c_count = 1; // 다른 선택창에 정보 기록하려고
                          var filterOne = 0;
                          var targetNo;  // 열고싶은 창 번호.
                          var targetWindow = 0; // 열었던 창 번호.
                          oMap.attach('click', function(oCustomEvent) {
                            var oTarget = oCustomEvent.target;
                            if (oTarget instanceof nhn.api.map.Marker) {
                                if (oCustomEvent.clickCoveredMarker) {
                                    return; //중복마커일때 처리하는 부분
                                }  
                              targetNo = oTarget._smallSrc;
                              
                              if (targetWindow == 0) {
                                mapInfoTestWindow[targetNo].setVisible(true);
                                mapInfoTestWindow[targetNo].setPosition({right : 15, top : 30});
                                mapInfoTestWindow[targetNo].autoPosition();
                                targetWindow = targetNo;
                                
                              } else if (targetWindow != 0) {
                                mapInfoTestWindow[targetWindow].setVisible(false);
                                mapInfoTestWindow[targetNo].setVisible(true);
                                mapInfoTestWindow[targetNo].setPosition({right : 15, top : 30});
                                mapInfoTestWindow[targetNo].autoPosition();
                                targetWindow = targetNo;
                              }
                           } 
                               if (!(oTarget instanceof nhn.api.map.Marker)) {
                                mapInfoTestWindow[targetWindow].setVisible(false);
                              } // 마커가 아니면 클릭시 닫힌다. 
                               console.log(targetNo);
                          });
                          
                          console.log(targetNo);
                          
                          

                          function closeOverlay() {
                            mapInfoTestWindow[targetWindow].setVisible(false);
                          }
                          
                          oMap.attach('mouseenter', function(oCustomEvent) {
                            var oTarget = oCustomEvent.target;
                            // 마커위에 마우스 올라간거면
                            if (oTarget instanceof nhn.api.map.Marker) {
                              var oMarker = oTarget;
                              oLabel.setVisible(true, oMarker); // - 특정 마커를 지정하여 해당 마커의 title을 보여준다.
                            }
                            
                            $("#choice_id"+ targetNo).click(function(event) {
                              if(targetNo != filterOne) {
                                event.preventDefault();
                                console.log("카운트 : "+c_count);
                                if ((c_count%4) == 1) {
                                  /* $("#choice_div1").text(targetNo); */
                                  $.getJSON('ajax/locationDetail.do?no=' + targetNo, function(resultObj) {
                                      var ajaxResult = resultObj.ajaxResult;
                                      if (ajaxResult.status == "success") {
                                        var location = ajaxResult.data;
                                        $("#choice_div1").html("<img src='"+ location.photo +"' id='img_icon' class='img-circle'>" +
                                            "<input type='hidden' name='lno1' value='"+ targetNo +"'>");
                                      }
                                  });
                                  c_count++;
                                } else if ((c_count%4) == 2) {
                                  $.getJSON('ajax/locationDetail.do?no=' + targetNo, function(resultObj) {
                                        var ajaxResult = resultObj.ajaxResult;
                                        if (ajaxResult.status == "success") {
                                          var location = ajaxResult.data;
                                          $("#choice_div2").html("<img src='"+ location.photo +"' class='img-circle'>" +
                                                  "<input type='hidden' name='lno2' value='"+ targetNo +"'>");
                                        }
                                    });
                                  c_count++;
                                } else if ((c_count%4) == 3) {
                                  $.getJSON('ajax/locationDetail.do?no=' + targetNo, function(resultObj) {
                                        var ajaxResult = resultObj.ajaxResult;
                                        if (ajaxResult.status == "success") {
                                          var location = ajaxResult.data;
                                          $("#choice_div3").html("<img src='"+ location.photo +"' class='img-circle'>" +
                                                  "<input type='hidden' name='lno3' value='"+ targetNo +"'>");
                                        }
                                    });
                                  c_count++;
                                } else if ((c_count%4) == 0) {
                                  $.getJSON('ajax/locationDetail.do?no=' + targetNo, function(resultObj) {
                                        var ajaxResult = resultObj.ajaxResult;
                                        if (ajaxResult.status == "success") {
                                          var location = ajaxResult.data;
                                          $("#choice_div4").html("<img src='"+ location.photo +"' class='img-circle'>" +
                                                  "<input type='hidden' name='lno4' value='"+ targetNo +"'>");
                                        }
                                    });
                                  c_count++;
                                }
                              }
                               filterOne = targetNo;
                            });
                          });
                          
                          oMap.attach('mouseleave', function(oCustomEvent) {
                            var oTarget = oCustomEvent.target;
                            // 마커위에서 마우스 나간거면
                            if (oTarget instanceof nhn.api.map.Marker) {
                              oLabel.setVisible(false);
                            }
                          }); 
     </script>
     <script type="text/javascript">
       try {document.execCommand('BackgroundImageCache', false, true);} catch(e) {}
     </script>
</body>
</html>