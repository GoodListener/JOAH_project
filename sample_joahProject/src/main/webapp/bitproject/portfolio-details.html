<!DOCTYPE html>
<html>
<head>
<meta charset='UTF-8'>
<title>Hot place</title>
<link rel="stylesheet" href="../lib/bootstrap/css/bootstrap.css">
<link rel="stylesheet" type="text/css"
	href="../lib/mycss/style_detail.css" />
<link rel="stylesheet" type="text/css"
	href="../lib/mycss/style_header.css" />
<script type="text/javascript" src="js/jquery.js"></script>
<script type="text/javascript" src="js/bootstrap.min.js"></script>
<script type="text/javascript" src="js/wow.min.js"></script>
<script type="text/javascript" src="js/main.js"></script>
<script type="text/javascript" src="../lib/myjs/jquery-ui.min.js"></script>
<script type="text/javascript" src="../lib/myjs/modernizr.js"></script>

<link href="css/bootstrap.min.css" rel="stylesheet">
<link href="css/font-awesome.min.css" rel="stylesheet">
<link href="css/animate.min.css" rel="stylesheet">
<link href="css/main.css" rel="stylesheet">
<link href="css/responsive.css" rel="stylesheet">

<!-- Syntax Highlighter -->
<link href="css/shCore.css" rel="stylesheet" type="text/css" />
<link href="css/shThemeDefault.css" rel="stylesheet" type="text/css" />
<!-- Demo CSS -->
<link rel="stylesheet" href="flexslider.css" type="text/css"
	media="screen" />

</head>
<body>
	<div id="main_container">
		<!-- header -->
		<header id="h_title"></header>

		<script type="text/javascript" src="../lib/jquery/jquery.js"></script>
		<script>
$("#h_title").load("header.html");
</script>

		<div class="center_content_pages">
			<div class="pages_banner">DETAIL</div>
		</div>

		<section class="col-md-12 margin-bottom" id="portfolio">
			<!-- LOCATION 정보 나오는 div -->
			<div class="left_content">
				<p>LOCATION</p>
				<ol class="rectangle-list">
					<li><a>이름이 짱짱길때는 쩜쩜쩜으로 나와야해요!</a></li>
					<li><a>List item</a></li>
					<li><a>List item</a></li>
					<li><a>List item</a></li>
				</ol>
			</div>

			<!-- 대표이미지 나오는 div -->
			<div class="right_content">
				<h1>
					<img src="Love-Letter.png" id="detail"> <label
						id="data_title" class="h23"></label>
				</h1>
				<div id="testMap"></div>
			</div>
			<p id="date" style="float: right;"></p>
		</section>

		<!-- 이미지 슬라이더 -->
		<section class="slider col-md-6">
			<div id="slider" class="flexslider">
				<ul class="slides" id="slides1"></ul>
			</div>
			<div id="carousel" class="flexslider">
				<ul class="slides" id="slides2"></ul>
			</div>
		</section>

		<section class="col-md-12">
			<div class="post-content">
				<h2 class="post-title bold">
					<a id="data_title2"></a>
				</h2>
				<h3 class="post-author">
					<a>Posted by micron News</a>
				</h3>
				<p id="content1"></p>
				<div class="post-bottom overflow">
					<ul class="nav navbar-nav post-nav">
						<li><a><i class="fa fa-tag"></i>Creative</a></li>
						<li><a><i class="fa fa-heart"></i>32 Love</a></li>
						<li><a><i class="fa fa-comments"></i>3 Comments</a></li>
<!-- 						<li><a name="fb_share" type="button_count" href="http://www.facebook.com/sharer.php">공유하기</a></li> -->
<!--                <script src="http://static.ak.fbcdn.net/connect.php/js/FB.Share" type="text/javascript"></script> -->
					</ul>
				</div>
				<div class="blog-share">
					<span class='st_facebook_hcount'></span> <span
						class='st_twitter_hcount'></span> <span class='st_linkedin_hcount'></span>
					<span class='st_pinterest_hcount'></span> <span
						class='st_email_hcount'></span>
				</div>

				<div class="response-area">
					<h2 class="bold">Comments</h2>

					<form method="post" action="#" data-ajax="true">
						<div class="row">
							<div class="col-sm-2">
								<img class="img-circle" id="profile_image" width="120"
									height="120" alt="">
							</div>

							<div class="col-sm-9">
								<dl class="comment_form_content">
									<dt>댓글 본문</dt>
									<dd>
										<div id="reply_indicator">
											<input type="hidden" name="parent" value="">
										</div>
										<textarea style="display: none" id="com-content"
											class="form-control" rows="3" name="cmt_content"
											placeholder="댓글 달리는 영역"></textarea>
										<textarea style="display: none" id="com-content2"
											class="form-control" rows="3" name="cmt_content"
											placeholder="로그인 한 후 이용 가능" readonly></textarea>
									</dd>
								</dl>
								<div class="buttons" style="float: right;">
									<input type="hidden" name="course_id" value="45"> <input
										type="hidden" name="module_id" value="0"> <input
										type="hidden" name="topic_id" value="0">

									<button type="button" id="comment-add-btn"
										class="btn btn-success">
										<span>댓글 올리기</span>
									</button>
								</div>
							</div>
						</div>
					</form>
					<!-- 댓글 DB 연동  -->
					<ul id="commentList" class="media-list wow fadeInDown">

					</ul>
				</div>
			</div>
		</section>
	</div>
	<!-- main_container 끝 -->

	<script type="text/javascript" src="../lib/jquery/jquery.min.js"></script>
	<script>
 var no = location.href.split('?')[1].split('=')[1];
 var cPhoto;
 $.getJSON('ajax/detailmember.do?id=' + sessionStorage.getItem('loginSession'), 
     function(resultObj) {
      var ajaxResult = resultObj.ajaxResult;
      if (ajaxResult.status == "success") {
        cPhoto = ajaxResult.data.photo;
        $("#profile_image").attr("src", "../profile_image/"+cPhoto);
      }
   });
 /*조회수 올리기*/
 $.getJSON('ajax/updateViews.do?no=' + no);
 
 $.getJSON('ajax/detail.do?no=' + no, function(resultObj) {
    var ajaxResult = resultObj.ajaxResult;
    if (ajaxResult.status == "success") {
      var board = ajaxResult.data;
      $("#testMap").html("<img src='images/portfolio/"+ board.photo +"'>")
      $("#data_title").text(board.title);
      $("#date").text(board.createdDate);
      $("#data_title2").text(board.title);
      $("#data_no").text(board.bno);
      $("#content1").text(board.content);
    }
 });
 
 $.getJSON('ajax/photodetail.do?no=' + no , function(resultObj) {
   var ajaxResult = resultObj.ajaxResult;
   if (ajaxResult.status == "success") {
     var photos = ajaxResult.data;
     console.log(photos);
     var list1 = $("#slides1");
     var list2 = $("#slides2");
     for (var i=0 ; i<=photos.length ; i++){
       $("<li><img id='list1' src='../board_photo/" + photos[i].photoName +"'/></li>").appendTo(list1);
       $("<li><img id='list2' src='../board_photo/" + photos[i].photoName +"'/></li>").appendTo(list2);
//        $("<li><img style='background:url('../board_photo/" + photos[i].photoName + "') no-repeat;background-size:100% auto;background-position:center center;background-color:black;'/></li>").appendTo(list);
       console.log(photos[i].photoName);
     }
     
   }
 });
 
 $.getJSON('ajax/comment.do?no=' + no, function(resultObj) {
       var com = $("#commentList");
       var count = 100;
       var dt, year, month, day, hour, minute, second, time;
      for (var comment of resultObj.data) {
         dt = new Date(comment.createdTime);
        year = dt.getYear();
        month = dt.getMonth() + 1;
        day = dt.getDate();
        hour = dt.getHours();
        minute = dt.getMinutes();
        second = dt.getSeconds();
        time = month + "월 " + day + "일 " + hour + "시" + minute + "분";
        $('<li id="comment_li'+comment.cno+'" class="media">')
        .html('<div class="post-comment wow fadeInDown" data-wow-duration="'+count+'ms" data-wow-delay="800ms">' +
        '<a class="pull-left"><img class="img-circle" width="70" height="70"' +
        'src="../profile_image/'+ comment.photo +'" alt="">' +
        '</a>' +
        '<div class="media-body">' +
        '<span><i class="fa fa-user"></i>Posted by <a>'+ comment.id +'</a></span><a style="position:relative; left:50px;"><i class="fa fa-clock-o"></i>'+ time +'</a>' +
        '          <p style="margin:0 20px 0 0; padding: 0 20px 0 0; position:relative; left:20px;">'+ comment.content +'</p>' +
        '          <ul class="nav navbar-nav post-nav">' +
        '            <li style="position:relative; left:500px;"><div class="deletecomment" id="comment' + comment.cno + '"><i class="fa fa-trash"></i>삭제</div></li>' +
      '            </ul>' +
       '         </div>' +
       '       </div></li>').appendTo(com);
        count += 100;
        $("#comment" + comment.cno).click(function(event) {
               var commentNo = $(this).attr("id").split('comment')[1];
                console.log(commentNo);
               $.getJSON('ajax/deletecomment.do?no='+ commentNo + '&id='+ sessionStorage.getItem('loginSession'), function(resultObj) {
                       var ajaxResult = resultObj.ajaxResult;
                       if (ajaxResult.status == "success") {
                          $("#comment_li"+commentNo).remove();
                          alert("게시물 삭제하였습니다.");
                       } else {
                          alert("게시 삭제에 실패했습니다.");
                      }
               });
            });
      }
   });
 
 var newListNo;
 $("#comment-add-btn").click(function(event) {
   $.post('ajax/addcomment.do', {
        id: sessionStorage.getItem('loginSession'),
        bno: no,
        content: $('#com-content').val(),
      }, function(resultObj) {
        var ajaxResult = resultObj.ajaxResult;
        if (ajaxResult.status == "success") {
           location.reload(true);
           /* console.log(ajaxResult.data);
           newListNo = ajaxResult.data;
           var com = $("#commentList");
           $('<li id="comment_li'+ ajaxResult.data +'" class="media">')
           .html('<div class="post-comment wow fadeInDown" data-wow-duration="100ms" data-wow-delay="800ms">' +
            '<a class="pull-left"> <img class="img-circle" width="70" height="70"' +
            'src="../profile_image/'+ cPhoto +'" alt="">' +
            '</a>' +
            '<div class="media-body">' +
            '<span><i class="fa fa-user"></i>Posted by <a>'+ sessionStorage.getItem('loginSession') +'</a></span><a style="position:relative; left:50px;"><i class="fa fa-clock-o"></i>방금 전</a>' +
            '          <p style="margin:0 20px 0 0; padding: 0 20px 0 0; position:relative; left:20px;">'+ $('#com-content').val() +'</p>' +
            '          <ul class="nav navbar-nav post-nav">' +
            '            <li style="position:relative; left:500px;"><div class="deletecomment" id="comment'+ newListNo +'"><i class="fa fa-reply"></i>삭제</div></li>' +
          '            </ul>' +
           '         </div>' +
           '       </div></li>').prependTo(com); */// 이게 한줄로 끝나다니....짜증난다.
        } 
      }, 'json');
    });
 
 $(".deletecomment").click(function(event) {
   console.log("버튼 눌렀을 때 반응");
   /* $.postJSON('ajax/deletecomment.do?no=', function(resultObj) {
     console.log($('#comment-no').val('value'));
          var ajaxResult = resultObj.ajaxResult;
          if (ajaxResult.status == "success") {
              alert("삭제 성공")
            } else {
            alert("게시물 삭제에 실패했습니다.");
          }
    }); */
 });
 
 /* 로그인 안한 사람 댓글 달 수 없어요.
    로그인 한 사람은 댓글에 아이디 뜨게 하기*/
   if(sessionStorage.getItem('loginSession') != undefined) {
     $('#before_login').val(sessionStorage.getItem('loginSession'));
  } else {
     $('#after_login')
  } 
  </script>

	<!-- jQuery -->
	<script
		src="http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>
	<script>window.jQuery || document.write('<script src="js/libs/jquery-1.7.min.js">\x3C/script>')</script>

	<!-- FlexSlider -->
	<script defer src="jquery.flexslider.js"></script>

	<script type="text/javascript">
    $(function(){
      SyntaxHighlighter.all();
    });
    $(window).load(function(){
      $('#carousel').flexslider({
        animation: "slide",
        controlNav: false,
        animationLoop: false,
        slideshow: false,
        itemWidth: 210,
        itemMargin: 5,
        asNavFor: '#slider'
      });

      $('#slider').flexslider({
        animation: "slide",
        controlNav: false,
        animationLoop: false,
        slideshow: false,
        sync: "#carousel"
      });
    });
  </script>


	<!-- Syntax Highlighter -->
	<script type="text/javascript" src="js/shCore.js"></script>
	<script type="text/javascript" src="js/shBrushXml.js"></script>
	<script type="text/javascript" src="js/shBrushJScript.js"></script>

	<!-- Optional FlexSlider Additions -->
	<script src="js/jquery.easing.js"></script>
	<script src="js/jquery.mousewheel.js"></script>
	<script defer src="js/demo.js"></script>


</body>
</html>